# -*- mode: Shell-script[bash]; -*-

# These are notes on how to set up the environment (mostly filesystem)
# This should be run interactively.



# We are assuming that the script files are in "$WORK/randombot_ng"

export MUC_R_HOME="$WORK/randombot_ng"
mkdir "$MUC_R_HOME"

--> scp something something "$WORK/randombot_ng"

# make sure the data directory is filled with tasks etc.
........................................................

# Install R, packages etc
.........................

# Set up environment
module load ...............

# choose the basedir to work with
# !!! apparently currently this must be WORK_LIST instead of WORK
# !!!
export BASEDIR="$WORK/results"
mkdir "$BASEDIR"

# create the nodelist. inspect this file when done
sinfo -O nodelist -N -h | sort | uniq > "$WORK/nodelist"

# populate the basedir with directory structure. This needs the list
# of nodes as input.
"$WORK/randombot_ng/setup/make_dirs.sh" "$BASEDIR" "$WORK/nodelist"


# set up command script
vim "$WORK/randombot_ng/scheduling/sbatch.cmd"
...................................

# run
export SCHEDULING_MODE=XXXX  # percpu, perparam, perseed
export USE_PARALLEL=TRUE # not necessary, default is TRUE; must be TRUE or FALSE
export INDEXSTEPSIZE=20  # not necessary, default is 20, but set this to something else on LRZ
# must also exported: BASEDIR
"${MUC_R_HOME}/scheduling/invoke_sbatch.sh" --partition=general

# to run from lrz, omit --partition and add --nodes=<small number>
